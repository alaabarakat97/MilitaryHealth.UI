<div class="supervisor-page container-fluid">
  <div class="row justify-content-center mb-3">
    <div class="col-12 col-md-6">
      <div class="search-wrapper">
        <button class="btn search-btn" (click)="loadApplicants()">
          <i class="fas fa-search"></i>
          <span>Ø§Ø¨Ø­Ø«</span>
        </button>
        <input type="text" class="form-control search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù..." dir="rtl"
          [(ngModel)]="searchValue">
      </div>
      <div *ngIf="!applicant && responseMessage" class="alert alert-warning mt-3" role="alert">
        {{ responseMessage }}
      </div>
    </div>
  </div>

  <div class="row g-2 mt-2" *ngIf="applicant">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØ§Ù„Ø·Ø¨ÙŠØ©</h5>
        </div>
        <div class="card-body py-2">
          <div class="row row-cols-2 row-cols-md-4 g-2 compact-grid">
            <div class="col-6 col-md-3">
              <strong>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù: </strong> <span>{{ applicant.fileNumber }}</span>
            </div>
            <div class="col-6 col-md-3">
              <strong>Ø§Ù„Ø§Ø³Ù…: </strong> <span>{{ applicant.fullName }}</span>
            </div>
            <div class="col-6 col-md-3">
              <strong>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©: </strong> <span>{{ getMaritalStatusDescription(applicant.maritalStatusID) }}</span>
            </div>
            <div class="col-6 col-md-3">
              <strong>Ø§Ù„ÙˆØ¸ÙŠÙØ©: </strong> <span>{{ applicant.job }}</span>
            </div>
            <div class="col-6 col-md-3">
              <strong>Ø§Ù„Ø·ÙˆÙ„: </strong> <span>{{ applicant.height }} Ø³Ù…</span>
            </div>
            <div class="col-6 col-md-3">
              <strong>Ø§Ù„ÙˆØ²Ù†: </strong> <span>{{ applicant.weight }} ÙƒØ¬Ù…</span>
            </div>
            <div class="col-6 col-md-3">
              <strong>BMI: </strong> <span>{{ applicant.bmi }}</span>
            </div>
            <div class="col-6 col-md-3">
              <strong>Ø¶ØºØ· Ø§Ù„Ø¯Ù…: </strong> <span>{{ applicant.bloodPressure }}</span>
            </div>
            <div class="col-6 col-md-3">
              <strong>Ø§Ù„Ù†Ø¨Ø¶: </strong> <span>{{ applicant.pulse }}</span>
            </div>
            <div class="col-6 col-md-3">
              <strong>ÙˆØ´Ù…: </strong> <span>{{ applicant.tattoo ? 'ÙŠÙˆØ¬Ø¯' : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯' }}</span>
            </div>
            <div class="col-12">
              <strong>Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ù…ÙŠØ²Ø©: </strong> <span>{{ applicant.distinctiveMarks || 'Ù„Ø§ ØªÙˆØ¬Ø¯' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-12 mt-4">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0">Ø§Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</h5>
        </div>
        <div class="card-body py-2">
          <div class="row row-cols-1 row-cols-md-2 g-2">
            <div class="col">
              <div class="border rounded p-2 small compact-exam-card">
                <h6 class="text-info mb-2">ğŸ‘ï¸ ÙØ­Øµ Ø§Ù„Ø¹ÙŠÙˆÙ†</h6>
                <ng-container *ngIf="applicant.eyeExam; ">
                  <div><strong>Ø§Ù„Ù†Ø¸Ø±:</strong> {{ applicant.eyeExam.vision }}</div>
                  <div><strong>Ø§Ù„Ø£Ù„ÙˆØ§Ù†:</strong> {{ applicant.eyeExam.colorTest }}</div>
                  <div><strong>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ù†ÙƒØ³Ø§Ø±:</strong> {{ applicant.eyeExam.refractionValue }}</div>
                  <div><strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> {{ getResultDescription(applicant.eyeExam.resultID) }}</div>
                </ng-container>
              </div>
            </div>
            
            <div class="col">
              <div class="border rounded p-2 small compact-exam-card">
                <h6 class="text-warning mb-2">ğŸ©º Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ø±Ø§Ø­ÙŠ</h6>
                <ng-container *ngIf="applicant.surgicalExam; else noData">
                  <div><strong>Ø¹Ø§Ù…:</strong> {{ applicant.surgicalExam.generalSurgery }}</div>
                  <div><strong>Ø§Ù„Ù…Ø³Ø§Ù„Ùƒ Ø§Ù„Ø¨ÙˆÙ„ÙŠØ©:</strong> {{ applicant.surgicalExam.urinarySurgery }}</div>
                  <div><strong>Ø§Ù„Ø£ÙˆØ¹ÙŠØ© Ø§Ù„Ø¯Ù…ÙˆÙŠØ©:</strong> {{ applicant.surgicalExam.vascularSurgery }}</div>
                  <div><strong>Ø§Ù„ØµØ¯Ø±:</strong> {{ applicant.surgicalExam.thoracicSurgery }}</div>
                  <div><strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> {{ getResultDescription(applicant.surgicalExam.resultID) }}</div>
                </ng-container>
              </div>
            </div>
            
            <div class="col">
              <div class="border rounded p-2 small compact-exam-card">
                <h6 class="text-danger mb-2">â¤ï¸ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¨Ø§Ø·Ù†ÙŠ</h6>
                <ng-container *ngIf="applicant.internalExam; else noData">
                  <div><strong>Ø§Ù„Ù‚Ù„Ø¨:</strong> {{ applicant.internalExam.heart }}</div>
                  <div><strong>Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„ØªÙ†ÙØ³ÙŠ:</strong> {{ applicant.internalExam.respiratory }}</div>
                  <div><strong>Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù‡Ø¶Ù…ÙŠ:</strong> {{ applicant.internalExam.digestive }}</div>
                  <div><strong>Ø§Ù„ØºØ¯Ø¯ Ø§Ù„ØµÙ…Ø§Ø¡:</strong> {{ applicant.internalExam.endocrine }}</div>
                  <div><strong>Ø§Ù„Ø£Ø¹ØµØ§Ø¨:</strong> {{ applicant.internalExam.neurology }}</div>
                  <div><strong>Ø§Ù„Ø¯Ù…:</strong> {{ applicant.internalExam.blood }}</div>
                  <div><strong>Ø§Ù„Ù…ÙØ§ØµÙ„:</strong> {{ applicant.internalExam.joints }}</div>
                  <div><strong>Ø§Ù„ÙƒÙ„Ù‰:</strong> {{ applicant.internalExam.kidney }}</div>
                  <div><strong>Ø§Ù„Ø³Ù…Ø¹:</strong> {{ applicant.internalExam.hearing }}</div>
                  <div><strong>Ø§Ù„Ø¬Ù„Ø¯:</strong> {{ applicant.internalExam.skin }}</div>
                  <div><strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> {{ getResultDescription(applicant.internalExam.resultID) }}</div>
                </ng-container>
              </div>
            </div>
            
            <div class="col">
              <div class="border rounded p-2 small compact-exam-card">
                <h6 class="text-secondary mb-2">ğŸ¦´ ÙØ­Øµ Ø§Ù„Ø¹Ø¸Ø§Ù…</h6>
                <ng-container *ngIf="applicant.orthopedicExamDto; else noData">
                  <div><strong>Ø¹Ø¶Ù„ÙŠ Ù‡ÙŠÙƒÙ„ÙŠ:</strong> {{ applicant.orthopedicExamDto.musculoskeletal }}</div>
                  <div><strong>Ø¬Ø±Ø§Ø­Ø© Ø¹ØµØ¨ÙŠØ©:</strong> {{ applicant.orthopedicExamDto.neurologicalSurgery }}</div>
                  <div><strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> {{ getResultDescription(applicant.orthopedicExamDto.resultID) }}</div>
                </ng-container>
              </div>
            </div>
            
            <div class="col">
              <div class="border rounded p-2 small compact-exam-card">
                <h6 class="text-dark mb-2">ğŸ“‘ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø©</h6>
                <ng-container *ngIf="applicant.consultation; else noData">
                  <div><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> {{ applicant.consultation.consultationType }}</div>
                  <div><strong>Ø§Ù„Ø·Ø¨ÙŠØ¨:</strong> {{ applicant.consultation.referredDoctor }}</div>
                </ng-container>
              </div>
            </div>
            
            <ng-template #noData>
              <div class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-12 mt-4">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0">Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h5>
        </div>
        <div class="card-body py-2">
          <form #decisionForm="ngForm">
            <div class="mb-3">
              <label class="form-label">Ø§Ù„Ù†ØªÙŠØ¬Ø©</label>
              <ng-select [items]="results" bindLabel="description" bindValue="resultID"
                [(ngModel)]="decisionModel.resultID" name="resultID" (ngModelChange)="onResultChange($event)"
                placeholder="Ø§Ø®ØªØ± Ø§Ù„Ù†ØªÙŠØ¬Ø©" [appendTo]="'body'">
              </ng-select>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Ø§Ù„Ø³Ø¨Ø¨</label>
              <textarea class="form-control" [(ngModel)]="decisionModel.reason" name="reason"></textarea>
            </div>
            @if(!isApproved){
            <div class="mb-3">
              <label class="form-label">Ù…Ø¯Ø© Ø§Ù„ØªØ£Ø¬ÙŠÙ„</label>
              <input type="text" class="form-control" [(ngModel)]="decisionModel.postponeDuration"
                name="postponeDuration" />
            </div>
            }
            <div class="text-end">
              <button type="button" class="btn btn-primary" (click)="submitDecision()">
                <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
              </button>
            </div>
            <div *ngIf="responseMessage" class="mt-3">
              <div class="alert" [ngClass]="{'alert-success': responseSuccess, 'alert-danger': !responseSuccess}"
                role="alert">
                {{ responseMessage }}
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>