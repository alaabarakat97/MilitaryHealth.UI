<div class="supervisor-page container">
  <div class="row justify-content-center mb-3">
    <div class="col-12 col-md-6">
      <div class="search-wrapper">
        <button class="btn search-btn" (click)="loadApplicants()">
          <i class="fas fa-search"></i>
          <span>ุงุจุญุซ</span>
        </button>
        <input type="text" class="form-control search-input" placeholder="ุงุจุญุซ ุนู ุฑูู ุงูููู..." dir="rtl"
          [(ngModel)]="searchValue">
      </div>
      <div *ngIf="!applicant && responseMessage" class="alert alert-warning mt-3" role="alert">
        {{ responseMessage }}
      </div>
    </div>
  </div>

  <!-- ุชูุงุตูู ุงูููุชุณุจ -->
  <div class="row g-4 mt-4" *ngIf="applicant">

    <!-- ูุงุฑุฏ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ูุงูุทุจูุฉ -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ ูุงูุทุจูุฉ</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <!-- ุจูุงูุงุช ุฃุณุงุณูุฉ -->
            <div class="col-md-6">
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between">
                  <strong>ุฑูู ุงูููู:</strong> <span>{{ applicant.fileNumber }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <strong>ุงูุงุณู:</strong> <span>{{ applicant.fullName }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <strong>ุงููุธููุฉ:</strong> <span>{{ applicant.job }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <strong>ุงูุญุงูุฉ ุงูุงุฌุชูุงุนูุฉ:</strong> <span>{{ getMaritalStatusDescription(applicant.maritalStatusID) }}</span>
                </li>
              </ul>
            </div>

            <!-- ุจูุงูุงุช ุทุจูุฉ -->
            <div class="col-md-6">
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between">
                  <strong>ุงูุทูู:</strong> <span>{{ applicant.height }} ุณู</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <strong>ุงููุฒู:</strong> <span>{{ applicant.weight }} ูุฌู</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <strong>BMI:</strong> <span>{{ applicant.bmi }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <strong>ุถุบุท ุงูุฏู:</strong> <span>{{ applicant.bloodPressure }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <strong>ุงููุจุถ:</strong> <span>{{ applicant.pulse }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <strong>ูุดู:</strong> <span>{{ applicant.tattoo ? 'ููุฌุฏ' : 'ูุง ููุฌุฏ' }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                  <strong>ุนูุงูุงุช ูููุฒุฉ:</strong> <span>{{ applicant.distinctiveMarks || 'ูุง ุชูุฌุฏ' }}</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ุงููุญูุตุงุช -->
    <div class="col-12 mt-4">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0">ุงููุญูุตุงุช ุงูุทุจูุฉ</h5>
        </div>
        <div class="card-body">
          <div class="row row-cols-2 row-cols-lg-3 g-2">

            <!-- ูุญุต ุงูุนููู -->
            <div class="col">
              <div class="border rounded p-2 small">
                <h6 class="text-info mb-2">๐๏ธ ูุญุต ุงูุนููู</h6>
                <ng-container *ngIf="applicant.eyeExam; else noEye">
                  <div><strong>ุงููุธุฑ:</strong> {{ applicant.eyeExam.vision }}</div>
                  <div><strong>ุงูุฃููุงู:</strong> {{ applicant.eyeExam.colorTest }}</div>
                </ng-container>
                <ng-template #noEye>
                  <div class="text-muted">ูุง ููุฌุฏ ุจูุงูุงุช</div>
                </ng-template>
              </div>
            </div>

            <!-- ุงููุญุต ุงูุฌุฑุงุญู -->
            <div class="col">
              <div class="border rounded p-2 small">
                <h6 class="text-warning mb-2">๐ฉบ ุงูุฌุฑุงุญู</h6>
                <ng-container *ngIf="applicant.surgicalExam; else noSurg">
                  <div><strong>ุนุงู:</strong> {{ applicant.surgicalExam.generalSurgery }}</div>
                  <div><strong>ุงููุณุงูู:</strong> {{ applicant.surgicalExam.urinarySurgery }}</div>
                </ng-container>
                <ng-template #noSurg>
                  <div class="text-muted">ูุง ููุฌุฏ ุจูุงูุงุช</div>
                </ng-template>
              </div>
            </div>

            <!-- ูุญุต ุงูุนุธุงู -->
            <div class="col">
              <div class="border rounded p-2 small">
                <h6 class="text-secondary mb-2">๐ฆด ุงูุนุธุงู</h6>
                <ng-container *ngIf="applicant.orthopedicExamDto; else noOrtho">
                  <div><strong>ุนุถูู:</strong> {{ applicant.orthopedicExamDto.musculoskeletal }}</div>
                  <div><strong>ุนุตุจู:</strong> {{ applicant.orthopedicExamDto.neurologicalSurgery }}</div>
                </ng-container>
                <ng-template #noOrtho>
                  <div class="text-muted">ูุง ููุฌุฏ ุจูุงูุงุช</div>
                </ng-template>
              </div>
            </div>

            <!-- ุงููุญุต ุงูุจุงุทูู -->
            <div class="col">
              <div class="border rounded p-2 small">
                <h6 class="text-danger mb-2">โค๏ธ ุงูุจุงุทูู</h6>
                <ng-container *ngIf="applicant.internalExam; else noInternal">
                  <div><strong>ููุจ:</strong> {{ applicant.internalExam.heart }}</div>
                  <div><strong>ุชููุณ:</strong> {{ applicant.internalExam.respiratory }}</div>
                </ng-container>
                <ng-template #noInternal>
                  <div class="text-muted">ูุง ููุฌุฏ ุจูุงูุงุช</div>
                </ng-template>
              </div>
            </div>

            <!-- ุงูุงุณุชุดุงุฑุฉ -->
            <div class="col">
              <div class="border rounded p-2 small">
                <h6 class="text-dark mb-2">๐ ุงูุงุณุชุดุงุฑุฉ</h6>
                <ng-container *ngIf="applicant.consultation; else noConsult">
                  <div><strong>ุงูููุน:</strong> {{ applicant.consultation.consultationType }}</div>
                  <div><strong>ุงูุทุจูุจ:</strong> {{ applicant.consultation.referredDoctor }}</div>
                </ng-container>
                <ng-template #noConsult>
                  <div class="text-muted">ูุง ููุฌุฏ ุจูุงูุงุช</div>
                </ng-template>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <div class="card shadow-sm mt-3">
      <div class="card-header bg-dark text-white">
        <h5 class="mb-0">ุงููุฑุงุฑ ุงูููุงุฆู</h5>
      </div>
      <div class="card-body">
        <form #decisionForm="ngForm">

          <div class="mb-3">
            <label class="form-label">ุงููุชูุฌุฉ</label>
            <ng-select [items]="results" bindLabel="description" bindValue="resultID"
              [(ngModel)]="decisionModel.resultID" name="resultID" (ngModelChange)="onResultChange($event)"
              placeholder="ุงุฎุชุฑ ุงููุชูุฌุฉ" [appendTo]="'body'">
            </ng-select>
          </div>

          @if(!isApproved){
          <div class="mb-3">
            <label class="form-label">ุณุจุจ ุงูุฑูุถ</label>
            <textarea class="form-control" [(ngModel)]="decisionModel.reason" name="reason"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">ูุฏุฉ ุงูุชุฃุฌูู</label>
            <input type="text" class="form-control" [(ngModel)]="decisionModel.postponeDuration"
              name="postponeDuration" />
          </div>
          }

          <div class="text-end">
            <button type="button" class="btn btn-primary" (click)="submitDecision()">
              <i class="fas fa-paper-plane"></i> ุฅุฑุณุงู
            </button>
          </div>
          <div *ngIf="responseMessage" class="mt-3">
            <div class="alert" [ngClass]="{'alert-success': responseSuccess, 'alert-danger': !responseSuccess}"
              role="alert">
              {{ responseMessage }}
            </div>
          </div>


        </form>
      </div>
    </div>

  </div>
</div>